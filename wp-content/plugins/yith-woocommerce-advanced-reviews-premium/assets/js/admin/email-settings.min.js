!function(c,d){var n="yith-ywar-email-field__row--empty-value",s=!1;function r(e,t,i,a){var n=e.closest(".yith-ywar-emails__email"),o=n.data("email"),r=d.get_preview_to_update(e);d.adminAjax({email:o,request:"reload_email_preview",style:t,body:i,heading:a},{block:c(r)}).done(function(e){c(r).html(e.data),"base"!==t&&(n.find(".yith-ywar-email-field__row."+t+" .header-colors .wp-color-picker").trigger("input"),n.find(".yith-ywar-email-field__row."+t+" .body-colors .wp-color-picker").trigger("input"),n.find(".yith-ywar-email-field__row."+t+" .logo-position").trigger("change")),c(document).trigger("yith-ywar-email-customizer")})}c(document).on("change",".yith-ywar-emails__email__toggle-active .on_off",function(){window.onbeforeunload=null;var e=c(this),t=e.closest(".yith-ywar-emails__email__toggle-active"),e={email:e.closest(".yith-ywar-emails__email").data("email"),request:"switch_email_activation",enabled:e.is(":checked")?"yes":"no"};d.adminAjax(e,{block:t})}).on("click",".yith-ywar-emails__email__toggle-editing",function(e){e.preventDefault();var e=c(this).closest(".yith-ywar-emails__email"),t=e.find(".yith-ywar-emails__email__options"),i=e.find("textarea.wp-editor-area");i.length&&i.each(function(){var e=c(this).attr("id");"tinymce"in window&&(e=window.tinymce.get(e))&&e.theme.resizeTo(undefined,300)}),e.is(".yith-ywar-emails__email--open")?(e.removeClass("yith-ywar-emails__email--open"),t.slideUp()):(e.addClass("yith-ywar-emails__email--open"),t.slideDown(),t.find(".email_style_selector").trigger("change"))}).on("click",".yith-ywar-emails__email__save",function(){"tinyMCE"in window&&"triggerSave"in window.tinyMCE&&window.tinyMCE.triggerSave();var t=c(this),i=t.closest(".yith-ywar-emails__email"),e=i.data("email"),a=i.find("form"),n=t.find(".yith-ywar-emails__email__save__text"),o=t.data("save-message"),r=t.data("saved-message"),l=function(e){e?(t.addClass("is-saved"),n.html(r)):(t.removeClass("is-saved"),n.html(o))},e={email:e,request:"update_email_options",data:function(e){var t,i={};for(t of e){var a,n=new RegExp("(\\[.*?\\])","gmi"),o=t.name.match(n),n=o&&o[0]?t.name.replace(n,""):t.name,r=t.value;o?(o=o[0].replace("[","").replace("]",""),(a=i[n]||{})[o]=r,i[n]=a):i[n]=r}return i}(a.serializeArray())};l(!1),s&&clearTimeout(s),d.adminAjax(e,{block:t}).done(function(e){e.success&&i.find(".email_style_selector").trigger("change"),l(!0),s=setTimeout(function(){l(!1)},1e3)})}).on("click",".yith-ywar-email-field__edit",function(e){e.preventDefault();var e=c(this).closest(".yith-ywar-email-field__row"),t=e.data("default-content"),i=e.find("textarea.wp-editor-area"),a=i.attr("id");"tinymce"in window&&((a=window.tinymce.get(a))?(a.theme.resizeTo(undefined,300),a.setContent(t.replace(/\r?\n/g,"<br />"))):i.val(t)),e.removeClass(n)}).on("click",".yith-ywar-email-field__use-default",function(){var e=c(this).closest(".yith-ywar-email-field__row"),t=e.find("textarea.wp-editor-area"),i=t.attr("id");"tinymce"in window&&((i=window.tinymce.get(i))?i.setContent(""):t.val("")),e.addClass(n)}).on("click",".yith-ywar-test-email",function(){var t=c(this).closest(".yith-plugin-fw-text-button-field-wrapper"),e=t.find(".yith-plugin-fw-text-input").val(),i=c(this).data("type");t.find(".yith-ywar-send-result").remove(),t.append('<div class="yith-ywar-send-result"></div>'),/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)?d.adminAjax({request:"send_test_mail",email:e,type:i},{block:t}).done(function(e){t.find(".yith-ywar-send-result").removeClass("send-progress").addClass(!0===e.success?"send-success":"send-fail").html(!0===e.success?ywar_admin.messages.after_send_test_email:ywar_admin.messages.test_mail_error)}):t.find(".yith-ywar-send-result").addClass("send-fail").html(ywar_admin.messages.test_mail_wrong)}).on("change",".email_style_selector",function(){var e,t=c(this).closest(".yith-ywar-emails__email"),i=t.find("textarea.wp-editor-area"),a=i.attr("id"),n=c(this).is(":disabled")?"base":c(this).val();t.is(".yith-ywar-emails__email--open")&&(""===(e="tinymce"in window?(t=window.tinymce.get(a))?t.getContent():i.val():e)&&(e=i.closest(".yith-ywar-email-field__row").data("default-content")),c(this).is(":disabled")||("base"===n?c(this).parent().parent().next(".yith-plugin-fw__panel__option__description").show():c(this).parent().parent().next(".yith-plugin-fw__panel__option__description").hide()),r(c(this),n,e))}).trigger("change").on("input",".header-colors .wp-color-picker",function(){c(d.get_preview_to_update(c(this))+" #template_header").css(c(this).data("prop"),c(this).val())}).on("input",".body-colors .wp-color-picker",function(){switch(c(this).data("prop")){case"link_color":c(d.get_preview_to_update(c(this))+" a:not(.review-button)").css("color",c(this).val());break;case"link_color_hover":var n=c(this).val(),o=c(this).closest(".yith-colorpicker-group").find('input[data-prop="link_color"]').val();c(d.get_preview_to_update(c(this))+" a:not(.review-button)").each(function(e,t){c(t).off("mouseenter mouseleave").on("mouseenter mouseleave",function(a){c(this).attr("style",function(e,t){var i=new RegExp("color: [0-9#a-fgr,();]*","gmi");return t.replace(" !important","").replace(i,"")+"color: "+("mouseenter"===a.type?n:o)+" !important;"})})});break;case"background-color":c(d.get_preview_to_update(c(this))+" #outer_wrapper").css(c(this).data("prop"),c(this).val());break;default:c(d.get_preview_to_update(c(this))+" #body_content_inner").css(c(this).data("prop"),c(this).val())}}).on("tinymce-editor-setup",function(e,a){a.on("KeyUp",function(e){var t=c("#"+a.id),i=t.closest(".yith-ywar-emails__email");r(t,i.find(".email_style_selector").val(),e.target.innerHTML,c(d.get_preview_to_update(t)+" .mail-heading").val())})}).on("input change",".upload-logo input",function(){var e=c(this).val(),t=c(".email_style_selector").val(),i="",t=c(this).closest(".yith-ywar-emails__email").find(".yith-ywar-email-field__row."+t+" .logo-position").val();""!==e&&(i='<p style="margin-top:0; padding: 0 0 16px 0; text-align: '+t+'"><img src="'+e+'" alt="" /></p>'),c(d.get_preview_to_update(c(this))+" #template_header_image").html(i)}).on("change",".logo-position",function(){var e=c(this).val(),t=c(".email_style_selector").val(),t=c(this).closest(".yith-ywar-emails__email").find(".yith-ywar-email-field__row."+t+" .upload-logo input").val();""!==t&&c(d.get_preview_to_update(c(this))+" #template_header_image").html('<p style="margin-top:0; padding: 0 0 16px 0; text-align: '+e+'"><img src="'+t+'" alt="" /></p>')}).on("mousemove",".wp-picker-holder",function(){c(this).parent().find(".wp-color-picker").trigger("input")}).on("keyup input",".mail-heading",function(){var e,t=c(this).closest(".yith-ywar-emails__email"),i=t.find("textarea.wp-editor-area"),t=t.find(".email_style_selector").val(),a=i.attr("id"),n=c(this).val(),o=c(this).attr("placeholder");""===(e="tinymce"in window?(a=window.tinymce.get(a))?a.getContent():i.val():e)&&(e=i.closest(".yith-ywar-email-field__row").data("default-content")),r(c(this),t,e,""!==n?n:o)}).on("input",".button-colors .wp-color-picker",function(){var e=c(this).closest(".yith-colorpicker-group"),o=e.find('input[data-prop="color"]').val(),r=e.find('input[data-prop="background-color"]').val(),l=e.find('input[data-prop="hover_text"]').val(),s=e.find('input[data-prop="hover_bg"]').val();c(d.get_preview_to_update(c(this))+" .review-button").css("color",o).css("background-color",r).each(function(e,t){c(t).off("mouseenter mouseleave").on("mouseenter mouseleave",function(n){c(this).attr("style",function(e,t){var i=new RegExp("background-color: [0-9#a-fgr,();]*","gmi"),a=new RegExp("color: [0-9#a-fgr,();]*","gmi");return t.replace(" !important","").replace(i,"").replace(a,"")+"background-color: "+("mouseenter"===n.type?s:r)+" !important; color: "+("mouseenter"===n.type?l:o)+" !important;"})})})}).on("keyup input",".button-text",function(){var e=c(this).val(),t=c(this).attr("placeholder");c(d.get_preview_to_update(c(this))+" .review-button").html(""!==e?e:t)}).on("keyup input",".unsubscribe-text",function(){var e=c(this).val(),t=c(this).attr("placeholder");c(d.get_preview_to_update(c(this))+" .yith-ywar-unsubscribe-link a").html(""!==e?e:t)}).on("yith-ywar-email-customizer",function(){c(".button-colors .wp-color-picker").trigger("input"),c(".button-text").trigger("input"),c(".unsubscribe-text").trigger("input")}),d.get_preview_to_update=function(e){return"."+e.closest(".yith-ywar-emails__email").data("email-id")}}(jQuery,window.ywar);